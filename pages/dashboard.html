<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" type="text/css" href="../style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="../images/favicon.ico">
  <title id="title">Weather Dashboard</title>
</head>


<body>
 
  <nav>
    <ul class="top-nav">
      <li class="nav-item"><img src="https://connectwithmusa.com/images/whoami/me.webp" width="30px" height="30px"></li>
      <li class="nav-item"><a href="3">Home</a></li>
      <li class="nav-item"><a href="3">Home</a></li>
      <li class="nav-item"><a href="3">Home</a></li>
      <li class="nav-item"><a href="3">Home</a></li>
      <li class="nav-item"><a href="3">Home</a></li>
    </ul>
  </nav>



<h1 id="dashboard-greeting"></h1>
	
<div id="invalid-wrapper">
	<button id="invalid-button"><a href="../index.html">You will be redirected in 5 seconds.</a></button>
</div>

<div class="grid" id="grid">

	<div class="grid-item">

  		<div class="stat-section">
			<h2> Stat </h2>
			<p> Information </p>
  		</div>

  		<div class="stat-section">
			<h2> Stat </h2>
			<p> Information </p>
			<p> weatherDesc</p>
			
			
  		</div>
	
	</div>

	<div class="grid-item">

		<div class="big-stat-section">
			<h2> Stat </h2>
			<p> Big stat! </p>
		</div>
	</div>

	
	
</div>




</body>







<script>
	// needed vars
	let apiKey = "582eaef8fa88ead22261302ca8720f2b"
	let city = localStorage.getItem("city");
	let units = "metric"
	const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${units}`
	document.getElementById('dashboard-greeting').innerHTML = city;


	async function get_stat (url) {
		// GET http request
		let response = await fetch(url);

		if (response.status == 200) {
			let data = await response.json();
			
			let cityName = data['name'];
			let country = data['sys']['country'];
			
			var sunrise = data['sys']['sunrise'];
			var sunrise = new Date(sunrise * 1000);

			var sunset = data['sys']['sunset'];
			var sunset = new Date(sunset * 1000);

			let weatherDesc = data['weather'][0]['description'];
			
			let temp = data['main']['temp'];
			let feelsLike = data['main']['feels_like'];
			let tempHigh = data['main']['temp_max'];
			let tempLow = data['main']['temp_min'];

			let humidity = data['main']['humidity'];
			let windSpeed = data['wind']['speed'];

			// When data was calculated. ie. last updated
			let dt = data['dt'];

			// UTC Timezone
			var timezone = data['timezone'];
			var timezonme = timezone / 360;

			document.getElementById('dashboard-greeting').innerHTML = cityName;
			document.getElementById('title').innerHTML = `${cityName} | Weather Dashboard`;
			console.log(data);
			console.log(cityName);
			console.log(sunrise);
			console.log(sunset);
			console.log(weatherDesc);
			console.log(country);
		}
		else {
			// hide grid and show button saying city was set wrong
			document.getElementById("grid").style.display = "none";
			document.getElementById('dashboard-greeting').style.color = "red";
			document.getElementById('invalid-wrapper').style.display = "flex";
			document.getElementById('dashboard-greeting').innerHTML = "Error, invalid city specified.";
			console.log(`Error! ${response.status}`);
			await new Promise(r => setTimeout(r, 5000));
			document.location.href = "../index.html";
		}

}

get_stat(url);

</script>


</html>


